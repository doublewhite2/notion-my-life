<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½å¥–å°ç¨‹åº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        secondary: '#EC4899',
                        neutral: '#1F2937',
                        'neutral-light': '#F3F4F6',
                        'star-1': '#E5E7EB',
                        'star-2': '#A3E635',
                        'star-3': '#FBBF24',
                        'star-4': '#FB923C',
                        'star-5': '#F97316',
                        'star-6': '#EF4444',
                        'star-7': '#8B5CF6',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-flip {
                perspective: 1000px;
                transform-style: preserve-3d;
            }
            .card-front, .card-back {
                backface-visibility: hidden;
                transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-back {
                transform: rotateY(180deg);
            }
            .card-flipped .card-front {
                transform: rotateY(180deg);
            }
            .card-flipped .card-back {
                transform: rotateY(0deg);
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .gradient-bg {
                background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-neutral-light to-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-8">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-neutral mb-2 text-shadow">æŠ½å¥–å°ç¨‹åº</h1>
            <p class="text-gray-600 text-lg">è¯•è¯•ä½ çš„è¿æ°”ï¼Œçœ‹çœ‹èƒ½æŠ½åˆ°ä»€ä¹ˆå¥½ä¸œè¥¿ï¼</p>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- å·¦ä¾§ï¼šå¥–å“å¯¼å…¥åŒº -->
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-effect rounded-xl p-6 shadow-lg transition-all duration-300 hover:shadow-xl">
                    <h2 class="text-xl font-bold text-neutral mb-4 flex items-center">
                        <i class="fa-solid fa-list-ul mr-2 text-primary"></i>
                        å¯¼å…¥å¥–å“åˆ—è¡¨
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label for="prizeList" class="block text-sm font-medium text-gray-700 mb-1">
                                ä»Notionå¤åˆ¶å¥–å“åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªå¥–å“ï¼Œåé¢è·Ÿç¨€æœ‰åº¦ğŸŒŸï¼‰
                            </label>
                            <textarea 
                                id="prizeList" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none"
                                rows="6"
                                placeholder="ä¾‹å¦‚ï¼š
ä¿¯å§æ’‘10ä¸ª	ğŸŒŸ
åƒä¸€ç‚¹å„¿é›¶é£Ÿ	ğŸŒŸğŸŒŸ
æ— åé¡¾ä¹‹å¿§Bç«™è§£é”30min	ğŸŒŸğŸŒŸğŸŒŸ
å‘¦å‘¦é¹¿é¸£	ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
è‡ªåŠ©é¤ä¸€æ¬¡ï¼	ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
3Dæ‰“å°æœº	ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
æ—…æ¸¸-æ—¥æœ¬	ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ"></textarea>
                        </div>
                        <button 
                            id="importBtn" 
                            class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fa-solid fa-upload mr-2"></i>
                            å¯¼å…¥å¥–å“
                        </button>
                        <div id="importStatus" class="hidden">
                            <div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg">
                                <div class="flex items-center">
                                    <i class="fa-solid fa-check-circle mr-2"></i>
                                    <span id="importMessage"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æŠ½å¥–æ§åˆ¶åŒº -->
                <div class="glass-effect rounded-xl p-6 shadow-lg transition-all duration-300 hover:shadow-xl">
                    <h2 class="text-xl font-bold text-neutral mb-4 flex items-center">
                        <i class="fa-solid fa-gift mr-2 text-primary"></i>
                        å¼€å§‹æŠ½å¥–
                    </h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-3">
                            <button 
                                id="draw1Btn" 
                                class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                                <i class="fa-solid fa-dice-one mr-1"></i>
                                å•æŠ½
                            </button>
                            <button 
                                id="draw10Btn" 
                                class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                                <i class="fa-solid fa-dice-ten mr-1"></i>
                                åè¿æŠ½
                            </button>
                            <button 
                                id="customDrawBtn" 
                                class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                                <i class="fa-solid fa-sliders mr-1"></i>
                                è‡ªå®šä¹‰
                            </button>
                        </div>
                        <div id="customDrawContainer" class="hidden">
                            <div class="flex items-center space-x-2">
                                <input 
                                    type="number" 
                                    id="customDrawCount" 
                                    min="1" 
                                    value="1" 
                                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                                <button 
                                    id="confirmCustomDrawBtn" 
                                    class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300">
                                    ç¡®å®š
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æŠ½å¥–ç»Ÿè®¡ -->
                <div class="glass-effect rounded-xl p-6 shadow-lg transition-all duration-300 hover:shadow-xl">
                    <h2 class="text-xl font-bold text-neutral mb-4 flex items-center">
                        <i class="fa-solid fa-chart-pie mr-2 text-primary"></i>
                        æŠ½å¥–ç»Ÿè®¡
                    </h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-white p-3 rounded-lg shadow">
                                <p class="text-sm text-gray-500">æ€»æŠ½å¥–æ¬¡æ•°</p>
                                <p id="totalDraws" class="text-2xl font-bold text-neutral">0</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow">
                                <p class="text-sm text-gray-500">è·å¾—å¥–å“æ•°</p>
                                <p id="totalPrizes" class="text-2xl font-bold text-neutral">0</p>
                            </div>
                        </div>
                        <div id="rarityStats" class="space-y-2">
                            <!-- è¿™é‡Œä¼šåŠ¨æ€ç”Ÿæˆå„ç¨€æœ‰åº¦çš„ç»Ÿè®¡ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæŠ½å¥–ç»“æœå’Œè®°å½• -->
            <div class="lg:col-span-2 space-y-6">
                <!-- æŠ½å¥–åŠ¨ç”»åŒº -->
                <div class="glass-effect rounded-xl p-6 shadow-lg transition-all duration-300 hover:shadow-xl">
                    <h2 class="text-xl font-bold text-neutral mb-4 flex items-center">
                        <i class="fa-solid fa-magic mr-2 text-primary"></i>
                        æŠ½å¥–ç»“æœ
                    </h2>
                    <div id="drawResultContainer" class="min-h-[200px] flex flex-wrap gap-4 justify-center items-center">
                        <div class="text-center text-gray-500">
                            <i class="fa-solid fa-arrow-down text-3xl mb-2 block"></i>
                            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æŠ½å¥–</p>
                        </div>
                    </div>
                    <div id="drawMessage" class="mt-4 text-center text-lg font-medium text-neutral hidden"></div>
                </div>

                <!-- ä¸­å¥–è®°å½• -->
                <div class="glass-effect rounded-xl p-6 shadow-lg transition-all duration-300 hover:shadow-xl">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-neutral flex items-center">
                            <i class="fa-solid fa-history mr-2 text-primary"></i>
                            ä¸­å¥–è®°å½•
                        </h2>
                        <button 
                            id="copyRecordsBtn" 
                            class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa-solid fa-copy mr-1"></i>
                            å¤åˆ¶è®°å½•
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¥–å“åç§°</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç¨€æœ‰åº¦</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody id="prizeRecords" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="3" class="px-6 py-4 text-center text-gray-500">æš‚æ— ä¸­å¥–è®°å½•</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- é¡µè„š -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>Â© 2025 æŠ½å¥–å°ç¨‹åº | ç¥ä½ å¥½è¿è¿è¿ï¼</p>
        </footer>
    </div>

    <script>
        // ç¨€æœ‰åº¦å¯¹åº”çš„é¢œè‰²å’Œæ¦‚ç‡
        const rarityConfig = {
            '1': { color: '#E5E7EB', probability: 0.05, count: 0 },
            '2': { color: '#A3E635', probability: 0.7645, count: 0 },
            '3': { color: '#FBBF24', probability: 0.1529, count: 0 },
            '4': { color: '#FB923C', probability: 0.025, count: 0 },
            '5': { color: '#F97316', probability: 0.007, count: 0 },
            '6': { color: '#EF4444', probability: 0.0005, count: 0 },
            '7': { color: '#8B5CF6', probability: 0.00013, count: 0 }
        };

        // å­˜å‚¨å¥–å“æ•°æ®
        let prizes = [];
        // å­˜å‚¨æŠ½å¥–è®°å½•
        let records = [];
        // æ€»æŠ½å¥–æ¬¡æ•°
        let totalDraws = 0;
        // æ€»å¥–å“æ•°ï¼ˆ10è¿æŠ½ä¼šå¤šä¸€ä¸ªï¼‰
        let totalPrizes = 0;

        // DOM å…ƒç´ 
        const prizeListEl = document.getElementById('prizeList');
        const importBtnEl = document.getElementById('importBtn');
        const importStatusEl = document.getElementById('importStatus');
        const importMessageEl = document.getElementById('importMessage');
        const draw1BtnEl = document.getElementById('draw1Btn');
        const draw10BtnEl = document.getElementById('draw10Btn');
        const customDrawBtnEl = document.getElementById('customDrawBtn');
        const customDrawContainerEl = document.getElementById('customDrawContainer');
        const customDrawCountEl = document.getElementById('customDrawCount');
        const confirmCustomDrawBtnEl = document.getElementById('confirmCustomDrawBtn');
        const drawResultContainerEl = document.getElementById('drawResultContainer');
        const drawMessageEl = document.getElementById('drawMessage');
        const totalDrawsEl = document.getElementById('totalDraws');
        const totalPrizesEl = document.getElementById('totalPrizes');
        const rarityStatsEl = document.getElementById('rarityStats');
        const prizeRecordsEl = document.getElementById('prizeRecords');
        const copyRecordsBtnEl = document.getElementById('copyRecordsBtn');

        // å¤„ç†å¥–å“å¯¼å…¥
        importBtnEl.addEventListener('click', () => {
            const text = prizeListEl.value.trim();
            if (!text) {
                showImportMessage('è¯·è¾“å…¥å¥–å“åˆ—è¡¨', 'error');
                return;
            }

            // è§£æå¥–å“åˆ—è¡¨
            const lines = text.split('\n');
            const parsedPrizes = [];

            lines.forEach(line => {
                if (!line.trim()) return;
                
                // åˆ†å‰²å¥–å“åç§°å’Œç¨€æœ‰åº¦
                const parts = line.split('\t');
                if (parts.length < 2) return;
                
                const name = parts[0].trim();
                const stars = (parts[1].match(/ğŸŒŸ/g) || []).length;
                
                if (name && stars >= 1 && stars <= 7) {
                    parsedPrizes.push({ name, stars });
                }
            });

            if (parsedPrizes.length === 0) {
                showImportMessage('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å¥–å“ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ ¼å¼', 'error');
                return;
            }

            // æŒ‰ç¨€æœ‰åº¦åˆ†ç»„å¥–å“
            prizes = parsedPrizes;
            showImportMessage(`æˆåŠŸå¯¼å…¥ ${parsedPrizes.length} ä¸ªå¥–å“`, 'success');
            
            // å¯ç”¨æŠ½å¥–æŒ‰é’®
            enableDrawButtons();
            // æ›´æ–°ç¨€æœ‰åº¦ç»Ÿè®¡UI
            updateRarityStats();
        });

        // æ˜¾ç¤ºå¯¼å…¥æ¶ˆæ¯
        function showImportMessage(message, type = 'success') {
            importMessageEl.textContent = message;
            importStatusEl.classList.remove('hidden');
            
            const statusBox = importStatusEl.querySelector('div');
            if (type === 'error') {
                statusBox.classList.remove('bg-green-50', 'border-green-200', 'text-green-700');
                statusBox.classList.add('bg-red-50', 'border-red-200', 'text-red-700');
                statusBox.querySelector('i').classList.remove('fa-check-circle');
                statusBox.querySelector('i').classList.add('fa-exclamation-circle');
            } else {
                statusBox.classList.remove('bg-red-50', 'border-red-200', 'text-red-700');
                statusBox.classList.add('bg-green-50', 'border-green-200', 'text-green-700');
                statusBox.querySelector('i').classList.remove('fa-exclamation-circle');
                statusBox.querySelector('i').classList.add('fa-check-circle');
            }
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                importStatusEl.classList.add('hidden');
            }, 3000);
        }

        // å¯ç”¨æŠ½å¥–æŒ‰é’®
        function enableDrawButtons() {
            draw1BtnEl.disabled = false;
            draw10BtnEl.disabled = false;
            customDrawBtnEl.disabled = false;
            
            // æ·»åŠ æ‚¬åœæ•ˆæœ
            [draw1BtnEl, draw10BtnEl, customDrawBtnEl].forEach(btn => {
                btn.classList.add('hover:scale-105', 'active:scale-95');
            });
        }

        // ç¦ç”¨æŠ½å¥–æŒ‰é’®
        function disableDrawButtons() {
            draw1BtnEl.disabled = true;
            draw10BtnEl.disabled = true;
            customDrawBtnEl.disabled = true;
            
            // ç§»é™¤æ‚¬åœæ•ˆæœ
            [draw1BtnEl, draw10BtnEl, customDrawBtnEl].forEach(btn => {
                btn.classList.remove('hover:scale-105', 'active:scale-95');
            });
        }

        // è‡ªå®šä¹‰æŠ½å¥–æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        customDrawBtnEl.addEventListener('click', () => {
            customDrawContainerEl.classList.toggle('hidden');
        });

        // ç¡®è®¤è‡ªå®šä¹‰æŠ½å¥–æ¬¡æ•°
        confirmCustomDrawBtnEl.addEventListener('click', () => {
            const count = parseInt(customDrawCountEl.value) || 1;
            if (count < 1) {
                customDrawCountEl.value = 1;
                return;
            }
            drawPrizes(count);
            customDrawContainerEl.classList.add('hidden');
        });

        // å•æŠ½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        draw1BtnEl.addEventListener('click', () => drawPrizes(1));

        // åè¿æŠ½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        draw10BtnEl.addEventListener('click', () => drawPrizes(10));

        // æŠ½å¥–é€»è¾‘
        function drawPrizes(count) {
            if (prizes.length === 0) {
                showImportMessage('è¯·å…ˆå¯¼å…¥å¥–å“åˆ—è¡¨', 'error');
                return;
            }
            
            disableDrawButtons();
            drawResultContainerEl.innerHTML = '';
            drawMessageEl.classList.add('hidden');
            
            // è®¡ç®—å®é™…è·å¾—çš„å¥–å“æ•°é‡ï¼ˆ10è¿æŠ½é¢å¤–å¤šä¸€ä¸ªï¼‰
            const actualCount = count === 10 ? 11 : count;
            
            // æ›´æ–°ç»Ÿè®¡
            totalDraws += count;
            totalPrizes += actualCount;
            
            // æ˜¾ç¤ºæŠ½å¥–åŠ¨ç”»
            const results = [];
            for (let i = 0; i < actualCount; i++) {
                const result = drawSinglePrize();
                results.push(result);
                
                // åˆ›å»ºå¡ç‰‡å…ƒç´ 
                const card = document.createElement('div');
                card.className = 'card-flip w-32 h-48 relative perspective-1000 cursor-pointer transition-all duration-300 hover:shadow-xl';
                card.dataset.prizeIndex = i;
                
                // å¡ç‰‡æ­£é¢
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front absolute w-full h-full bg-white rounded-lg shadow-md flex items-center justify-center';
                cardFront.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fa-solid fa-gift text-4xl text-primary mb-2"></i>
                        <p class="font-medium">ç‚¹å‡»æŸ¥çœ‹</p>
                    </div>
                `;
                
                // å¡ç‰‡èƒŒé¢
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back absolute w-full h-full bg-white rounded-lg shadow-md flex flex-col items-center justify-center p-4';
                cardBack.innerHTML = `
                    <div class="w-full h-32 bg-gray-100 rounded mb-2 flex items-center justify-center overflow-hidden">
                        <div class="text-center">
                            <i class="fa-solid fa-box-open text-5xl text-gray-400"></i>
                        </div>
                    </div>
                    <h3 class="font-bold text-center mb-1">${result.name}</h3>
                    <div class="flex justify-center">
                        ${'ğŸŒŸ'.repeat(result.stars)}
                    </div>
                `;
                cardBack.style.backgroundColor = rarityConfig[result.stars].color;
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                drawResultContainerEl.appendChild(card);
                
                // æ·»åŠ å¡ç‰‡ç‚¹å‡»ç¿»è½¬äº‹ä»¶
                card.addEventListener('click', () => {
                    card.classList.add('card-flipped');
                });
                
                // è‡ªåŠ¨ç¿»è½¬å¡ç‰‡
                setTimeout(() => {
                    card.classList.add('card-flipped');
                    
                    // æœ€åä¸€å¼ å¡ç‰‡ç¿»è½¬åæ˜¾ç¤ºæ¶ˆæ¯
                    if (i === actualCount - 1) {
                        setTimeout(() => {
                            showDrawMessage(results);
                            enableDrawButtons();
                        }, 500);
                    }
                }, 300 + i * 200);
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            // æ·»åŠ åˆ°è®°å½•
            addRecords(results);
        }

        // æŠ½å–å•ä¸ªå¥–å“
        function drawSinglePrize() {
            // æ ¹æ®æ¦‚ç‡é€‰æ‹©ç¨€æœ‰åº¦
            const random = Math.random();
            let cumulativeProbability = 0;
            let selectedRarity = 1;
            
            // ä¿®å¤ï¼šç¡®ä¿æ¦‚ç‡æ€»å’Œä¸º1
            const normalizedRarities = {
                '1': 0.05,
                '2': 0.7645,
                '3': 0.1529,
                '4': 0.025,
                '5': 0.007,
                '6': 0.0005,
                '7': 0.00013
            };
            
            // è®¡ç®—å®é™…æ¦‚ç‡æ€»å’Œ
            let probabilitySum = 0;
            for (const key in normalizedRarities) {
                probabilitySum += normalizedRarities[key];
            }
            
            // å½’ä¸€åŒ–æ¦‚ç‡
            for (const key in normalizedRarities) {
                normalizedRarities[key] = normalizedRarities[key] / probabilitySum;
            }
            
            for (const rarity in normalizedRarities) {
                cumulativeProbability += normalizedRarities[rarity];
                if (random < cumulativeProbability) {
                    selectedRarity = parseInt(rarity);
                    break;
                }
            }
            
            // ä»è¯¥ç¨€æœ‰åº¦çš„å¥–å“ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
            const eligiblePrizes = prizes.filter(prize => prize.stars === selectedRarity);
            const selectedPrize = eligiblePrizes[Math.floor(Math.random() * eligiblePrizes.length)] || {
                name: `æœªçŸ¥å¥–å“ (${selectedRarity}æ˜Ÿ)`,
                stars: selectedRarity
            };
            
            // æ›´æ–°ç¨€æœ‰åº¦è®¡æ•°
            rarityConfig[selectedRarity].count++;
            
            return selectedPrize;
        }

        // æ˜¾ç¤ºæŠ½å¥–ç»“æœæ¶ˆæ¯
        function showDrawMessage(results) {
            const rarePrizes = results.filter(prize => prize.stars >= 5);
            let message = '';
            
            if (rarePrizes.length > 0) {
                // æŠ½åˆ°ç¨€æœ‰å¥–å“
                if (rarePrizes.length >= 3) {
                    message = 'å“‡å¡ï¼ä½ è¿™æ˜¯æ¬§çš‡é™„ä½“äº†å§ï¼ä¸€ä¸‹å­æŠ½åˆ°è¿™ä¹ˆå¤šç¨€æœ‰å¥–å“ï¼';
                } else if (rarePrizes.length === 2) {
                    message = 'åŒé»„è›‹ï¼ä»Šå¤©è¿æ°”çˆ†æ£šå•Šï¼Œç»§ç»­ä¿æŒï¼';
                } else if (rarePrizes.length === 1) {
                    const highestRarity = Math.max(...rarePrizes.map(p => p.stars));
                    if (highestRarity >= 7) {
                        message = 'æ­å–œä½ æŠ½åˆ°äº†ä¼ è¯´çº§å¥–å“ï¼ä»Šå¤©æ˜¯ä½ çš„å¹¸è¿æ—¥ï¼';
                    } else if (highestRarity === 6) {
                        message = 'å²è¯—çº§å¥–å“åˆ°æ‰‹ï¼è¿æ°”ä¸é”™å“¦ï¼';
                    } else {
                        message = 'ä¸é”™å˜›ï¼ŒæŠ½åˆ°äº†ç¨€æœ‰å¥–å“ï¼ç»§ç»­åŠªåŠ›ï¼';
                    }
                }
            } else {
                // æ²¡æŠ½åˆ°ç¨€æœ‰å¥–å“
                const lowestRarity = Math.min(...results.map(p => p.stars));
                if (lowestRarity === 1 && results.length > 5) {
                    message = 'ä½ å°å­è¿˜è¿æ°”æœ‰ç‚¹è¡°å•Šï¼Œå†æ¥å†å‰ï¼';
                } else if (lowestRarity <= 2) {
                    message = 'æ™®é€šå¥–å“å±…å¤šï¼Œä¸‹æ¬¡ä¸€å®šå‡ºå¥‡è¿¹ï¼';
                } else {
                    message = 'ä¸­è§„ä¸­çŸ©çš„ä¸€æ¬¡æŠ½å¥–ï¼Œç»§ç»­åŠ æ²¹ï¼';
                }
            }
            
            drawMessageEl.textContent = message;
            drawMessageEl.classList.remove('hidden');
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            drawMessageEl.classList.add('animate-bounce');
            setTimeout(() => {
                drawMessageEl.classList.remove('animate-bounce');
            }, 1000);
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            totalDrawsEl.textContent = totalDraws;
            totalPrizesEl.textContent = totalPrizes;
            updateRarityStats();
        }

        // æ›´æ–°ç¨€æœ‰åº¦ç»Ÿè®¡
        function updateRarityStats() {
            rarityStatsEl.innerHTML = '';
            
            for (let i = 7; i >= 1; i--) {
                const rarityData = rarityConfig[i];
                const statItem = document.createElement('div');
                statItem.className = 'flex items-center justify-between p-2 bg-white rounded-lg shadow-sm';
                statItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full mr-2" style="background-color: ${rarityData.color}"></span>
                        <span>${'ğŸŒŸ'.repeat(i)}</span>
                    </div>
                    <span class="font-medium">${rarityData.count} ä¸ª</span>
                `;
                rarityStatsEl.appendChild(statItem);
            }
        }

        // æ·»åŠ è®°å½•
        function addRecords(newRecords) {
            const now = new Date();
            newRecords.forEach(record => {
                records.push({
                    ...record,
                    time: now.toLocaleString()
                });
            });
            
            updateRecordsTable();
        }

        // æ›´æ–°è®°å½•è¡¨æ ¼
        function updateRecordsTable() {
            if (records.length === 0) {
                prizeRecordsEl.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-6 py-4 text-center text-gray-500">æš‚æ— ä¸­å¥–è®°å½•</td>
                    </tr>
                `;
                return;
            }
            
            prizeRecordsEl.innerHTML = '';
            // åªæ˜¾ç¤ºæœ€è¿‘çš„10æ¡è®°å½•
            const recentRecords = records.slice(-10);
            
            recentRecords.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900">${record.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <span class="inline-block w-6 h-6 rounded-full mr-2" style="background-color: ${rarityConfig[record.stars].color}"></span>
                            ${'ğŸŒŸ'.repeat(record.stars)}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${record.time}
                    </td>
                `;
                prizeRecordsEl.appendChild(row);
            });
        }

        // å¤åˆ¶è®°å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        copyRecordsBtnEl.addEventListener('click', () => {
            if (records.length === 0) {
                showImportMessage('æ²¡æœ‰è®°å½•å¯å¤åˆ¶', 'error');
                return;
            }
            
            // å‡†å¤‡è¦å¤åˆ¶çš„å†…å®¹
            let copyText = "å¥–å“åç§°\tç¨€æœ‰åº¦\tæ—¶é—´\n";
            records.forEach(record => {
                copyText += `${record.name}\t${'ğŸŒŸ'.repeat(record.stars)}\t${record.time}\n`;
            });
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(copyText)
                .then(() => {
                    showImportMessage(`æˆåŠŸå¤åˆ¶ ${records.length} æ¡è®°å½•`, 'success');
                })
                .catch(err => {
                    showImportMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                });
        });

        // åˆå§‹åŒ–ç¦ç”¨æŠ½å¥–æŒ‰é’®
        disableDrawButtons();
    </script>
</body>
</html>
    